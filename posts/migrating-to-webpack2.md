Migrating to Webpack 2
======================

These days everybody is talking about _tree shaking_ for optimizing bundle size of _Single Page Applications_ (SPA).

There are tree options, as far as I’m aware of, to achieve such  thing:

* **[Rollup](http://rollupjs.org/)** is another packager for JavaScript applications.
* **[Google Closure Compiler](https://developers.google.com/closure/compiler/)** which can also generate nice human readable code.
* **[Webpack 2](https://webpack.js.org/)** which is the one I’m going to try because I really like **Webpack** and I already have some loaders for it.

**Webpack** _minification_ relies on **[UglfyJS](http://lisperator.net/uglifyjs/)** which has some issues with _immediately-invoked function expression_ (IIFE). Classes generated by _transpilers_ are usually wrapped into this functions and are not candidates to removal even if the class is not used. I’m not an expert on the subject, but I think it may be solved once we can use **UglifyJS** directly with **ES6**. In any case, I can live with this small issue.

As a reference, with **Webpack 1** I’m getting this numbers on my bundles:

```
469K -> bundle.js
3.8M -> bundle.js.map
```

## First step, verify that everything is running as it should

Done.

## Update to Webpack 2

The latest version of **Webpack** at the moment of writing this post is `2.2.0-rc.3` which is the one I’m getting now. It will need also an upgrade of _webpack-dev-server_ to `2.2.0-rc.0`.

After changing the version in my `package.json` and running `npm install` I’m getting some errors when I try to run `npm start`. 

```
throw new WebpackOptionsValidationError(webpackOptionsValidationErrors);
```

No surprises at this point. What was a surprise was that my bundle was almost the same size as before.

A handy tool for this kind of scenarios is the [Webpack Visualizer](https://chrisbateman.github.io/webpack-visualizer/) from _chrisbateman_. After running it on my build, I noticed that a third part of it was **RxJS**, which has like a hundred methods in its API from where I usually use less than ten.

The problem with **RxJS** is that **UglifyJS** will not be a good improvement because many of the operators are added to the _Observable_ prototype with _IIFE_ functions that are considered _impure_ (which they are) and hence not removed even if the operator itself is not used. The solution for this was to _import only what you need_ which is the recommended approach from **RxJS** documentation.

```javascript
// Before
import {Observable, Subject} from 'rxjs'

// After
import {Observable} from 'rxjs/Observable'
import {Subject} from 'rxjs/Subject'
import 'rxjs/add/operator/merge'
import 'rxjs/add/operator/filter'
import 'rxjs/add/operator/map'

```

The final numbers are:

```
301K -> bundle.js
2.3M -> bundle.js.map
```

